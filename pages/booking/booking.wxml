<!-- pages/doorList/doorList.wxml -->
<wxs src="../../utils/magic.wxs" module="magic" />
<view class="logo-top">
  <view class="logo-name" style="display: flex;align-items: center;flex-direction: row;gap: 10rpx;margin-bottom: 10rpx;">
    <image class="logo" src="/logo.png"></image>
    <text class="name" style="color: #fff !important;">{{doorinfodata.storeName}}</text>
  </view>
  <!-- 营业时间 -->
  <view class="store-card-info" style="display: flex;align-items: center;flex-direction: row;gap: 10rpx;">
    <view class="info-icon iconfont icon-clock" style="color: #fff !important;"></view>
    <text class="info-text" style="color: #fff !important;font-size: 24rpx;">营业时间: {{doorinfodata.businessHours || '00:00-24:00'}}</text>
  </view>
</view>
<view class="container" style="padding-top:120rpx">
  <!-- 日期选择 -->
  <view class="date-selector">
      <view class="date-item {{timeselectindex === index ? 'active' : ''}}" wx:for="{{timeDayArr}}" wx:key="index" bindtap="selectDate" data-index="{{index}}">
        <view class="date-day">{{item}}</view>
        <view class="date-week">{{timeWeekArr[index]}}</view>
      </view>
    <view class="calendar-btn" bindtap="openCalendar">
      <image class="calendar-icon" src="/pages/static/icon/time.png"></image>
    </view>
  </view>
  <!-- 日历组件：支持单日选择，展示三个月区间 -->
  <van-calendar show="{{ calendarShow }}" type="single" min-date="{{ calendarMinDate }}" max-date="{{ calendarMaxDate }}" color="#07c160" bind:confirm="onCalendarConfirm" bind:close="onCalendarClose" bind:cancel="onCalendarClose" />
  <view class="top-tabs-container">
    <view class="top-tabs">
      <block wx:for="{{roomClass}}" wx:key="roomClass">
        <view data-index="{{item.value}}" class="tab {{tabIndex === item.value && 'active'}}" bind:tap="tabChange">
          {{item.text}}
        </view>
      </block>
    </view>
  </view>
  <!-- 房间列表 -->
  <view class="lists" wx:for="{{doorlistArr}}" wx:key="doorlistArr" id="roomList">
    <view class="item">
      <view class="top">
        <view class="left">
          <block wx:if="{{item.imageUrls.length>0}}">
            <image class="img" src="{{magic.split(item.imageUrls)[0]}}" catchtap="imgYu" data-index="{{index}}" binderror="onRoomImageError"></image>
          </block>
          <block wx:else>
            <image class="img" src="/logo.png"></image>
          </block>
          <block wx:if="{{item.status == 0}}">
            <view class="flag disabled">禁用</view>
          </block>
          <block wx:elif="{{item.status == 1}}">
            <view class="flag undo">空闲中</view>
          </block>
          <block wx:elif="{{item.status == 2}}">
            <view class="flag daiqingjie">待清洁</view>
          </block>
          <block wx:elif="{{item.status == 3}}">
            <view class="flag doing">使用中</view>
          </block>
          <block wx:else>
            <view class="flag bukeyong">已预约</view>
          </block>
        </view>
        <view class="right" catch:tap="goOrder" data-status="{{item.status}}" data-index="{{index}}" data-info="{{item.roomId}}">
          <view class="info">
            <view class="name">
              {{item.roomName}}
              <block wx:if="{{item.type == 0}}">
                <text class="type">（特价包）</text>
              </block>
              <block wx:elif="{{item.type == 1}}">
                <text class="type">（小包）</text>
              </block>
              <block wx:elif="{{item.type == 2}}">
                <text class="type">（中包）</text>
              </block>
              <block wx:elif="{{item.type == 3}}">
                <text class="type">（大包）</text>
              </block>
              <block wx:elif="{{item.type == 4}}">
                <text class="type">（豪包）</text>
              </block>
              <block wx:else>
                <text class="type">（商务包）</text>
              </block>
            </view>
            <!-- <view class="tags">
              <block wx:for="{{magic.split(item.label)}}" wx:for-item="labelitem" wx:key="label">
                <view class="tag">{{labelitem}}</view>
              </block>
            </view> -->
          </view>
          <view class="line2">
            <view class="priceLabel">
              <view class="price">
                <label class="color-attention">￥{{item.price}}元/小时</label>
              </view>
              <view class="original-price">原价￥{{item.originalPrice || 0}}元</view>
            </view>
            <view class="bottom">
              <view class="action-btn-2 reserve-btn" catchtap="goOrder" data-status="{{item.status}}" data-index="{{index}}" data-info="{{item.roomId}}">
                <text style="color: #fff;">预订</text>
              </view>
              <view class="status-info">
                <block wx:if="{{item.status == 0}}">
                  <text class="status-text disabled">禁用</text>
                </block>
                <block wx:elif="{{item.status == 1}}">
                  <text class="status-text available">空闲中 暂无预订</text>
                </block>
                <block wx:elif="{{item.status == 2}}">
                  <text class="status-text cleaning">待清洁</text>
                </block>
                <block wx:elif="{{item.status == 3}}">
                  <text class="status-text occupied">使用中</text>
                </block>
                <block wx:else>
                  <text class="status-text booked">已预约</text>
                </block>
              </view>
            </view>
          </view>
        </view>
      </view>
      <view class="foot">
        <view class="timeline">
          <view class="timeline-slots">
            <block wx:for="{{timeHourAllArr[index]}}" wx:for-item="houritem2" wx:key="hour">
              <view class="time-slot">
                <view class="slot-marker {{houritem2.disable ? 'disabled' : ''}} {{houritem2.lowPrice ? 'low-price' : ''}} {{houritem2.highPrice ? 'high-price' : ''}}"></view>
                <text class="slot-time">{{houritem2.displayHour}}</text>
              </view>
            </block>
          </view>
          <view class="timeline-legend">
            <view class="legend-item">
              <view class="legend-dot unavailable"></view>
              <text>不可约</text>
            </view>
            <view class="legend-item">
              <view class="legend-dot available"></view>
              <text>可约时段</text>
            </view>
            <view class="legend-item">
              <view class="legend-dot low-price"></view>
              <text>低价时段</text>
            </view>
            <view class="legend-item">
              <view class="legend-dot high-price"></view>
              <text>高价时段</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <!-- 温馨提示 -->
  <!-- <view class="notes">
    <view class="title border-primary">温馨提示</view>
    <view class="line">1.下单5分钟内可以取消订单或更换房间，超时将无法取消！</view>
    <view class="line">2.订单可以提前开始消费，提前开始提前结束。</view>
    <view class="line">3.消费时间不足时，我们进行提醒。若房间后续时间已被他人预定，将无法续费！请您留意消费时长！</view>
    <view class="line">4.预约时间结束后，房间将断电，灯光会自动熄灭。为了不影响下一位朋友使用，请您及时收拾物品离席。</view>
    <view class="line">5.严禁黄、赌、毒打架斗殴等一切违法活动！</view>
    <view class="line">6.破坏或带走本场所提供的设备设施请照价赔偿！</view>
    <view class="line">7.请自行保管好私人物品，如有遗失概不负责！</view>
    <view class="line">8.特殊情况，或需要帮助，请联系客服处理！</view>
  </view> -->
</view>