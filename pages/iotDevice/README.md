# 物联网设备管理页面

## 功能概述

这是一个完整的物联网设备管理页面，集成了所有必要的API接口调用功能，提供现代化的用户界面和良好的用户体验。

## 主要功能

### 1. 设备信息管理
- **设备基本信息展示**: 显示设备ID、产品Key、创建时间、最后修改时间等
- **设备状态监控**: 实时显示设备连接状态（在线/离线/未激活/禁用）
- **设备属性查看**: 展示设备当前的所有属性值
- **属性设置**: 支持远程设置设备属性

### 2. 设备列表管理
- **批量设备查询**: 支持分页查询设备列表
- **设备状态筛选**: 可按设备状态进行筛选
- **设备详情展示**: 显示每个设备的详细信息
- **下拉刷新**: 支持下拉刷新设备列表
- **上拉加载**: 支持上拉加载更多设备

### 3. 历史数据查询
- **时间范围选择**: 支持选择查询的时间范围
- **属性筛选**: 可选择特定属性进行历史数据查询
- **历史数据展示**: 以列表形式展示历史数据
- **数据格式化**: 自动格式化时间戳和数值

## API接口集成

### 已集成的接口

1. **获取云端资源Token** (`/api/token`)
   - 用于获取访问API的认证令牌
   - 自动处理Token过期和刷新

2. **获取设备基本信息** (`/api/thing/info`)
   - 获取设备的详细基本信息
   - 包括设备ID、状态、创建时间等

3. **获取设备属性** (`/api/thing/properties`)
   - 获取设备当前的所有属性值
   - 实时显示设备状态

4. **获取设备属性模板** (`/api/thing/tsl`)
   - 获取设备的TSL功能模板
   - 包含属性、事件、服务的定义

5. **设置设备属性** (`/api/thing/properties/set`)
   - 远程设置设备属性
   - 支持实时控制设备

6. **获取设备连接状态** (`/api/thing/status`)
   - 获取设备的实时连接状态
   - 用于状态监控

7. **批量获取设备信息** (`/api/things/info`)
   - 支持分页查询设备列表
   - 可按状态筛选

8. **获取历史数据** (`/api/thing/property/timeline`)
   - 查询设备属性的历史数据
   - 支持时间范围筛选

## 配置说明

### 设备配置
在 `iotDevice.js` 文件的 `data.deviceConfig` 中配置：

```javascript
deviceConfig: {
  username: "YH18129635675",        // 用户名
  password: "18129635675",          // 密码
  deviceName: "H4GAAL3002257111144", // 设备名称
  productKey: "a1PzAASSINWBRQ"      // 产品Key
}
```

### API地址配置
当前配置的API地址为：`http://hkapi.tchjjc.com`

## 页面结构

```
pages/iotDevice/
├── iotDevice.js      # 页面逻辑文件
├── iotDevice.wxml    # 页面模板文件
├── iotDevice.wxss    # 页面样式文件
├── iotDevice.json    # 页面配置文件
└── README.md         # 说明文档
```

## 使用方法

### 1. 页面跳转
```javascript
wx.navigateTo({
  url: '/pages/iotDevice/iotDevice'
});
```

### 2. 功能调用
页面加载后会自动：
1. 获取Token
2. 加载设备信息
3. 获取设备属性
4. 获取设备模板

### 3. 交互操作
- **切换标签页**: 点击顶部标签切换不同功能模块
- **下拉刷新**: 在设备列表页面下拉可刷新数据
- **上拉加载**: 在设备列表页面底部上拉可加载更多
- **属性设置**: 在设备信息页面可设置设备属性
- **历史查询**: 在历史数据页面可选择时间范围和属性进行查询

## 技术特点

### 1. 现代化UI设计
- 采用卡片式布局，视觉层次清晰
- 使用圆角、阴影等现代设计元素
- 响应式设计，适配不同屏幕尺寸

### 2. 良好的用户体验
- 加载状态提示
- 错误处理和提示
- 空状态展示
- 触摸反馈效果

### 3. 代码架构
- 模块化设计，功能分离清晰
- 统一的错误处理机制
- 可复用的工具方法
- 完善的注释文档

### 4. 性能优化
- Token自动管理，避免重复请求
- 分页加载，减少数据传输
- 防抖处理，避免频繁请求
- 缓存机制，提升响应速度

## 注意事项

1. **网络请求**: 确保网络连接正常，API地址可访问
2. **权限配置**: 确保小程序有网络请求权限
3. **Token管理**: Token会自动过期，页面会自动处理刷新
4. **错误处理**: 网络错误和API错误都有相应的提示
5. **数据格式**: 确保API返回的数据格式符合预期

## 扩展功能

可以根据需要扩展以下功能：
- 设备实时监控图表
- 设备告警管理
- 设备固件升级
- 设备分组管理
- 数据导出功能
- 批量操作功能

## 更新日志

- **v1.0.0**: 初始版本，包含基础功能
- 完整的API接口集成
- 现代化的UI设计
- 完善的错误处理
- 良好的用户体验



